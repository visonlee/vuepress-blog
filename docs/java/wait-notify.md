## javaçš„wait,notifyçš„ç”¨æ³•

javaçš„wait,notifyæœºåˆ¶åº•å±‚å®ç°æ˜¯æ“ä½œç³»ç»Ÿçš„ç®¡ç¨‹æ¨¡å‹,è€Œè¿™é‡Œçš„`ç®¡ç¨‹æ¨¡å‹`,javaä½¿ç”¨äº†åŸºäº`MESA`çš„ç®¡ç¨‹æ¨¡å‹ã€‚

```java
import java.util.ArrayList;
import java.util.List;

/**
 * é”™è¯¯åŠ¨ä½œç¤ºèŒƒ,è¿è¡Œè¿™æ®µä»£ç ä¼šæŠ¥æ•°ç»„è¶Šç•Œå¼‚å¸¸,è¿™é‡Œæ¼”ç¤ºäº†wait()æ–¹æ³•æ”¾åœ¨ifæ¡ä»¶åˆ¤æ–­é‡Œé¢ä¼šå¯¼è‡´å¼‚å¸¸,
 * å¯¼è‡´å¼‚å¸¸çš„æœ€å…³é”®åŸå› æ˜¯,Object.wait()æ–¹æ³•è°ƒç”¨å,ä¼šé‡Šæ”¾é”,ä¹Ÿå°±æ˜¯é‡Šæ”¾CPUä½¿ç”¨æƒ,åŒäº‹è¯¥çº¿ç¨‹ä¼šåŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­,è€Œå½“è°ƒç”¨äº†Object.notify(),ä¼šå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹,å…·ä½“æ˜¯é˜Ÿåˆ—ä¸­çš„å“ªä¸ªçº¿ç¨‹æ˜¯ä¸ç¡®å®šçš„,å…·ä½“å‚è€ƒObjectä»£ç çš„æ³¨é‡Š,ä½¿ç”¨äº†ifè¯­å¥åˆ¤æ–­,è°ƒç”¨äº†waitæ–¹æ³•å,
 * çº¿ç¨‹è¢«å”¤é†’å,ä¼šç»§ç»­ä»wait()è¯­å¥åé¢çš„ä»£ç æ‰§è¡Œ,è€Œç”¨äº†whileè¯­å¥,
 * è¿˜ä¼šç»§ç»­åˆ¤æ–­å¾ªç¯æ¡ä»¶æ˜¯å¦æˆç«‹,å¦‚æœæˆç«‹ä¼šç»§ç»­æ‰§è¡Œwait()æ–¹æ³•ç»§ç»­ç­‰å¾…
 *
 */
public class MyQueue<T> {

    private List<T> list = new ArrayList();

    private int MAX_SIZE = 10;

    public synchronized void offer(T item) {
        //TODO ä¸ç”¨ç”¨ifåˆ¤æ–­,è€Œè¦ç”¨whileå¾ªç¯åˆ¤æ–­
        if (isFull()) {
            System.out.println("é˜Ÿåˆ—å·²æ»¡");
            try {
                wait();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        this.list.add(item);
        notify();
    }

    public synchronized T take() {
        //TODO ä¸ç”¨ç”¨ifåˆ¤æ–­,è€Œè¦ç”¨whileå¾ªç¯åˆ¤æ–­
        if (isEmpty()) {
            System.out.println("é˜Ÿåˆ—ä¸ºç©º");
            try {
                wait();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        T item = list.remove(0);
        notify();
        return item;
    }

    private boolean isEmpty() {
        return list.isEmpty();
    }

    private boolean isFull() {
        return list.size() >= MAX_SIZE;
    }

    public static void main(String[] args) {
        MyQueue<String> myQueue = new MyQueue();

/**
    * ä¸€ä¸ªç”Ÿäº§è€…çº¿ç¨‹,ä¸¤ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹
    * å½“æˆ‘å¼€å¯äº†ä¸¤ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹,å’Œä¸€ä¸ªç”Ÿäº§è€…çº¿ç¨‹(ç¡çœ 3ç§’åç”Ÿäº§æ•°æ®),ä¸€å¼€å§‹æ²¡æœ‰ä¹¦é˜Ÿåˆ—ä¸ºç©º,
    * æ¶ˆè´¹è€…æ‹¿æ•°æ®(æ‰§è¡Œtakeæ–¹æ³•),
    *  æ¡ä»¶åˆ¤æ–­é˜Ÿåˆ—ä¸ºç©º,æ‰€ä»¥ä¸¤ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹éƒ½è¿›å…¥waitçŠ¶æ€ã€‚ä¸‰ç§’è¿‡å, ç”Ÿäº§è€…çº¿ç¨‹äº§ç”Ÿäº†æ•°æ®, 
    * æ— è®ºç”Ÿäº§è€…çº¿ç¨‹è°ƒç”¨notifyè¿˜æ˜¯notifyAllæ–¹æ³•,éƒ½ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚
    *  æƒ…å†µä¸€ğŸ˜³:å½“ç”Ÿäº§è€…çº¿ç¨‹è°ƒç”¨notify,ç”Ÿäº§è€…ä¼šéšæœºå”¤é†’å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹,
    *          å¦‚æœä½¿ç”¨äº†ifæ¥åˆ¤æ–­,çº¿ç¨‹è¢«å”¤é†’åä¼šç»§ç»­æ‰§è¡Œwaitåé¢çš„åˆ é™¤æ•°æ®çš„æ–¹æ³•,
    *          ç„¶åæ‰§è¡Œnotify()æ–¹æ³•,æ­¤æ—¶è¯¥æ¶ˆè´¹è€…çº¿ç¨‹ä¼šå”¤é†’å¦å¤–ä¸€ä¸ªæ­£åœ¨waitçš„æ¶ˆè´¹è€…çº¿ç¨‹,
    *          è¢«è¯¥æ¶ˆè´¹è€…å”¤é†’çš„å¦å¤–ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹,è¢«å”¤é†’åä¼šç»§ç»­æ‰§è¡Œwait
    *          åé¢çš„åˆ é™¤æ•°æ®çš„æ–¹æ³•,è¿™ä¸ªæ—¶å€™å°±å®Œè›‹äº†,å› ä¸ºæ•°ç»„ä¸ºç©º,ä¼šäº§ç”Ÿè¶Šç•Œ
    *
    *  æƒ…å†µäºŒğŸ˜³:å½“ç”Ÿäº§è€…çº¿ç¨‹è°ƒç”¨notifyAll,ç”Ÿäº§è€…ä¼šå”¤é†’å…¶ä¸­æ‰€æœ‰çš„æ­£åœ¨waitçš„è€…çº¿ç¨‹,
    *          å¦‚æœä½¿ç”¨äº†ifæ¥åˆ¤æ–­,ä¸¤ä¸ªåŒæ—¶è¢«å”¤é†’çš„æ¶ˆè´¹è€…çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œwaitåé¢çš„åˆ é™¤æ•°æ®çš„æ–¹æ³•,
    *          æ­¤æ—¶æ•°æ®å…ƒç´ åªæœ‰ä¸€ä¸ªæ‰§è¡Œä¸¤æ¬¡åˆ é™¤æ“ä½œ,äº§ç”Ÿè¶Šç•Œå¼‚å¸¸
    */
        new Thread(() -> { //æ¶ˆè´¹è€…çº¿ç¨‹1
            String take = myQueue.take();
            System.out.println("çº¿ç¨‹1æ‹¿åˆ°çš„æ•°æ®ä¸º:" + take);


        }).start();

        new Thread(() -> {//æ¶ˆè´¹è€…çº¿ç¨‹1

            String take = myQueue.take();
            System.out.println("çº¿ç¨‹2æ‹¿åˆ°çš„æ•°æ®ä¸º:" + take);

        }).start();

        new Thread(() -> {//ç”Ÿäº§è€…çº¿ç¨‹ç¡3ç§’åäº§ç”Ÿæ•°æ®

            try {
                Thread.sleep(3000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }

            System.out.println(Thread.currentThread().getName() + "ç”Ÿäº§è€…å¼€å§‹æ’å…¥æ•°æ®");
            myQueue.offer("hello");

        }).start();
    }

}
```